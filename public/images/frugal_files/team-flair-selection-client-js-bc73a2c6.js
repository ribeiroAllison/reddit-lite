import{l as e,ae as t,W as s,A as a,B as i,g as r,k as o,aF as n,aG as d,b as l,c,a as p,_ as u,w as h,n as m,e as b}from"./shell-10899a6f.js";import{x as f,k as y,I as S,s as w}from"./icon-732d0443.js";import{l as v,L as T}from"./list-item-c0043cac.js";import"./faceplate-bottom-sheet-header-c25970a1.js";import"./faceplate-bottom-sheet-f113e7a5.js";import"./faceplate-modal-af17da60.js";import"./TinyGesture-b7fb4b5e.js";const g=({actionReason:s,subredditId:a,subredditName:i})=>e({source:"global",action:"view",noun:"screen"},{action_info:{page_type:t.FlairsList,reason:s},subreddit:{id:a,name:i}}),x=({eventType:t,actionReason:s,subredditId:a,subredditName:i,flairId:r,flairText:o})=>e({source:"flair_prompt",action:"submit",noun:"flair"},{action_info:{type:t,reason:s},user_flair:{id:r,title:o},subreddit:{id:a,name:i}});var I,F,k;!function(e){e.Subreddit="community",e.Post="post_detail",e.Leaderboard="leaderboard"}(I||(I={})),function(e){e.Success="success",e.Failure="failure"}(F||(F={})),function(e){e.Emoji="emoji",e.Text="text"}(k||(k={}));const E=/:(.*?):/g;var N;!function(e){e.DEFAULT="team",e.COUNTRY="country"}(N||(N={}));let A=class extends(s(w)){constructor(){super(...arguments),this.isDesktopViewport=!1,this.subredditId="",this.subredditName="",this.username="",this.flairs=[],this.teamType=N.DEFAULT,this.actionReason=I.Subreddit,this.isAlwaysShown=!1,this.TeamTypesCopies={[N.DEFAULT]:"Time escolhido!",[N.COUNTRY]:"País escolhido!"},this.open=()=>{const e={actionReason:this.isAlwaysShown?I.Leaderboard:this.actionReason,subredditId:this.subredditId,subredditName:this.subredditName};if(this.isDesktopViewport?this.modal?.open||(this.modal?.showModal(),this.trackEvent(g(e))):this.bottomSheet?.open||(this.bottomSheet?.showModal(),this.trackEvent(g(e))),a.isAvailable()){const e=JSON.parse(a.getItem(i.TeamFlairSelectionIsShown)||"{}");a.setItem(i.TeamFlairSelectionIsShown,JSON.stringify({...e,[this.subredditId]:!0}))}},this.close=()=>{this.isDesktopViewport?this.modal?.close():this.bottomSheet?.close()}}get flairTemplateRadioBtns(){return document.querySelectorAll('faceplate-radio-input[name="flairTemplateId"]')}firstUpdated(){requestAnimationFrame((()=>{if(a.isAvailable()){const e=JSON.parse(a.getItem(i.TeamFlairSelectionIsShown)||"{}");if(Array.isArray(e)){const t={};if(e.forEach((e=>{t[e]=!0})),a.setItem(i.TeamFlairSelectionIsShown,JSON.stringify({...t})),t[this.subredditId]&&!this.isAlwaysShown)return}if(e[this.subredditId]&&!this.isAlwaysShown)return}this.open()}))}async onFlairSelect(e,t,s){e.preventDefault();const a={actionReason:this.isAlwaysShown?I.Leaderboard:this.actionReason,flairId:t,flairText:s.toString(),subredditId:this.subredditId,subredditName:this.subredditName};try{if((await this.makeUpdateUserFlairRequest(t,s))?.data?.updateUserFlair?.ok){this.dispatchEvent(r("faceplate-alert",{level:o.success,message:this.TeamTypesCopies[this.teamType]})),this.trackEvent(x({...a,eventType:F.Success}));for(const e of this.flairTemplateRadioBtns){e.getAttribute("value")===t&&e.click()}}else this.showErrorMessage(),this.trackEvent(x({...a,eventType:F.Failure}))}catch(e){window.Sentry?.captureError?.(e),this.showErrorMessage(),this.trackEvent(x({...a,eventType:F.Failure}))}this.close()}async makeUpdateUserFlairRequest(e,t){return n({operation:d.UpdateUserFlairAndEnabledStatus,variables:{subredditId:this.subredditId??"",isEnabled:!0,flairTemplateId:e,text:t,shouldUpdateUserFlair:!0,shouldUpdateUserFlairEnabledStatus:!0,username:this.username??""}})}showErrorMessage(){this.dispatchEvent(r("faceplate-alert",{level:o.error,message:"Algo deu errado"}))}getTitleText(){return"Por quem você está torcendo?"}renderCloseButton(){return f`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${t.FlairsList}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"dismiss"},subreddit:{id:this.subredditId,name:this.subredditName}})}" \n slot="closeButton" \n>\n ${l({appearance:"secondary",leadingIcon:y({size:S.Small}),size:c.Small,attributes:{onclick:this.close,className:"close-button","aria-label":"Fechar o modal de seleção de flair de time"}})}</faceplate-tracker>`}renderFlairLabel(e){if(!e.text.match(E)||!e.richtext)return{label:e.text.replace(E,"").trim()};const t=JSON.parse(e.richtext);let s="",a=f``;for(const e of t)e.e===k.Emoji&&e.u&&(a=f` <img \n alt="Emoji personalizado definido pelos moderadores do subreddit" \n src="${e.u}" \n class="w-md h-md mx-xs" \n>`),e.e===k.Text&&e.t&&(s=e.t);return{label:s,leadingIcon:a}}renderFlairsList(){return f`\n ${this.flairs.map((e=>f`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${t.FlairsList}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"choose"},subreddit:{id:this.subredditId,name:this.subredditName},user_flair:{id:e.id,title:e.text}})}" \n>${v({...this.renderFlairLabel(e),size:T.Medium,onClick:t=>this.onFlairSelect(t,e.id,e.text),attributes:{className:"w-full text-18","aria-label":`Etiqueta para o time ${e.text}`}})}\n </faceplate-tracker>`))}\n `}renderModal(){return f`<faceplate-modal \n ?shouldContentScroll="${!0}" \n class="z-10 rounded-lg w-[370px] max-h-[600px] s:w-[454px] m:w-[455px]" \n>\n ${this.renderCloseButton()}\n <div slot="title" class="text-18">${this.getTitleText()}</div>\n <div class="flex flex-col justify-center w-full">${this.renderFlairsList()}</div>\n </faceplate-modal>`}renderBottomSheet(){return f`<faceplate-bottom-sheet>\n <faceplate-bottom-sheet-header slot="header" has-divider>\n ${this.getTitleText()}\n <span slot="trailing"> ${this.renderCloseButton()}</span>\n </faceplate-bottom-sheet-header>\n <div class="box-border p-md pb-lg w-full overflow-y-scroll">${this.renderFlairsList()}</div>\n </faceplate-bottom-sheet>`}render(){return this.isDesktopViewport?this.renderModal():this.renderBottomSheet()}};A.styles=[p],u([h("faceplate-modal")],A.prototype,"modal",void 0),u([h("faceplate-bottom-sheet")],A.prototype,"bottomSheet",void 0),u([m({type:Boolean,attribute:"is-desktop-viewport"})],A.prototype,"isDesktopViewport",void 0),u([m({type:String,attribute:"subreddit-id"})],A.prototype,"subredditId",void 0),u([m({type:String,attribute:"subreddit-name"})],A.prototype,"subredditName",void 0),u([m({type:String,attribute:"username"})],A.prototype,"username",void 0),u([m({type:Array,attribute:"flairs"})],A.prototype,"flairs",void 0),u([m({type:String,attribute:"team-type"})],A.prototype,"teamType",void 0),u([m({type:String,attribute:"action-reason"})],A.prototype,"actionReason",void 0),u([m({type:Boolean,attribute:"is-always-shown"})],A.prototype,"isAlwaysShown",void 0),A=u([b("team-flair-selection-modal")],A);
//# sourceMappingURL=team-flair-selection-client-js-bc73a2c6.js.map
